<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>할일 목록</title>
    <style>
      body {
        text-align: center;
      }
      ul {
        padding: 0;
      }
      .header {
        font-size: large;
        font-weight: bold;
      }
      .list {
        width: 400px;
        background-color: cornsilk;
        margin: auto;
        border-radius: 20px;
      }
      .items {
        height: 500px;
        overflow-y: auto;
      }
      .item {
        display: flex;
        justify-content: space-between;
        padding: 8px 32px;
      }
      .divider {
        width: 90%;
        height: 1px;
        background-color: dimgray;
        margin: auto;
      }
    </style>
  </head>
  <body>
    <section class="list">
      <header class="header">ToDoList</header>
      <ul class="items">
        <li class="item_row">
          <div class="item">
            <span class="item_name">운동하기</span>
            <button class="item_delete">삭제하기</button>
          </div>
          <div class="item_divider"></div>
        </li>
      </ul>
      <footer>
        <input type="text" class="addText" />
        <button class="addBtn">추가하기</button>
      </footer>
    </section>
    <script>
      const items = document.querySelector('.items');
      const input = document.querySelector('.addText');
      const addBtn = document.querySelector('.addBtn');
      // 고유한 ID 값
      let itemId = 1;

      window.addEventListener('load', function () {
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          const value = localStorage.getItem(key);
          createItem(value, key);
        }
      });

      function onAdd() {
        console.log(input.value);

        const text = input.value;
        const id = `item-${itemId}`; // 고유한 아이디값 생성
        const item = createItem(text, id);
        items.appendChild(item);

        itemId++;
        input.value = '';
        input.focus();
      }

      // 할일 추가 버튼
      addBtn.addEventListener('click', function () {
        onAdd();
      });

      function createItem(text, id) {
        const itemRow = document.createElement('li');
        itemRow.setAttribute('class', 'item_row');
        itemRow.setAttribute('id', id);

        const item = document.createElement('div');
        item.setAttribute('class', 'item');

        const name = document.createElement('span');
        name.setAttribute('class', 'item_name');
        name.innerText = text;

        const deleteBtn = document.createElement('button');
        deleteBtn.setAttribute('class', 'item_delete');
        deleteBtn.innerHTML = '삭제하기';
        deleteBtn.addEventListener('click', function () {
          items.removeChild(itemRow);
          // 로컬 스토리지 아이디 삭제
          localStorage.removeItem(id);
        });

        const itemDivider = document.createElement('div');
        itemDivider.setAttribute('class', 'item_divider');

        item.appendChild(name);
        item.appendChild(deleteBtn);
        itemRow.appendChild(item);
        itemRow.appendChild(itemDivider);

        // localStorage.setItem(itemRow.id, name.innerHTML);
        localStorage.setItem(id, text);

        items.appendChild(itemRow);

        return itemRow;
      }
    </script>
  </body>
</html>
